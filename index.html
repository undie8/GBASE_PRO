<!doctype html>
<html lang="th" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sci Shop POS Pro - 2026</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Prompt', sans-serif; }
    .gradient-bg { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); }
    .card-glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); } /* */
    .btn-primary { background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); transition: 0.3s; } /* */
    .hide { display: none !important; } /* */
    .tab-active { border-bottom: 4px solid #6366f1; color: #6366f1; font-weight: bold; }
    .admin-tab-active { background-color: white; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); color: #6366f1; }
  </style>
</head>

<body class="h-full gradient-bg overflow-hidden" onload="checkSession()">
  <div id="app" class="h-full overflow-auto text-gray-800 pb-10">
    <div id="toast-container" class="fixed top-4 right-4 z-[100] flex flex-col gap-2"></div>

    <div id="auth-page" class="min-h-full flex items-center justify-center p-4">
      <div class="card-glass rounded-3xl shadow-2xl p-8 w-full max-w-md">
        <div class="text-center mb-6">
            <span class="text-6xl">üî¨</span>
            <h1 class="text-3xl font-bold mt-2">Sci Shop</h1>
        </div>
        <div class="flex mb-6 bg-gray-100 rounded-xl p-1">
          <button onclick="switchAuth('login')" id="tab-l" class="flex-1 py-2 rounded-lg font-bold bg-white shadow">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
          <button onclick="switchAuth('reg')" id="tab-r" class="flex-1 py-2 rounded-lg font-bold text-gray-400">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
        </div>
        <form id="login-form" onsubmit="handleLogin(event)" class="space-y-4">
          <input type="text" id="l-user" required class="w-full p-3 rounded-xl border outline-none" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ">
          <input type="password" id="l-pass" required class="w-full p-3 rounded-xl border outline-none" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
          <button type="submit" id="login-btn" class="w-full btn-primary text-white py-3 rounded-xl font-bold">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
        </form>
        <form id="reg-form" onsubmit="handleRegister(event)" class="space-y-4 hide">
          <input type="text" id="r-user" required class="w-full p-3 rounded-xl border outline-none" placeholder="‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ">
          <input type="password" id="r-pass" required class="w-full p-3 rounded-xl border outline-none" placeholder="‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
          <button type="submit" class="w-full bg-blue-500 text-white py-3 rounded-xl font-bold">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
        </form>
      </div>
    </div>

    <div id="shop-page" class="hide min-h-full flex flex-col">
      <header class="bg-white shadow-sm sticky top-0 z-40 px-4 py-2">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
          <div class="flex items-center gap-2">
              <span class="text-3xl">üß™</span>
              <h1 class="font-bold text-xl hidden sm:block">Sci Shop POS</h1>
          </div>
          
          <nav class="flex gap-6 mx-4">
              <button onclick="switchMainTab('shop')" id="m-tab-shop" class="py-3 px-2 tab-active transition-all">üè† ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</button>
              <button onclick="switchMainTab('profile')" id="m-tab-profile" class="py-3 px-2 text-gray-400 transition-all">üë§ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</button>
              <button onclick="switchMainTab('admin')" id="m-tab-admin" class="py-3 px-2 text-gray-400 hide transition-all">‚öôÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏ö</button>
          </nav>

          <div class="flex items-center gap-3">
            <div class="bg-green-50 px-3 py-1 rounded-full border border-green-200">
                <span class="text-green-600 font-bold">‡∏ø <span id="balance-display">0</span></span>
            </div>
            <button onclick="toggleCart()" class="relative p-2 bg-pink-50 rounded-full">
                üõí <span id="cart-count" class="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] w-5 h-5 rounded-full flex items-center justify-center font-bold">0</span>
            </button>
            <button onclick="logout()" class="p-2 hover:bg-gray-100 rounded-full">üö™</button>
          </div>
        </div>
      </header>

      <main class="flex-1 max-w-7xl mx-auto w-full px-4 py-6 overflow-auto">
        
        <section id="view-shop" class="space-y-6">
            <div class="flex flex-wrap gap-4 items-center justify-between">
                <div class="relative w-full md:w-72">
                    <input type="text" id="search-input" oninput="renderProducts()" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤..." class="w-full pl-10 pr-4 py-2 rounded-xl border border-gray-200 focus:ring-2 ring-indigo-500 outline-none">
                    <span class="absolute left-3 top-2.5">üîç</span>
                </div>
            </div>
            <div id="product-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4"></div>
        </section>

        <section id="view-profile" class="hide space-y-4">
            <h2 class="text-2xl font-bold">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>
            <div id="user-history-list" class="space-y-2"></div>
        </section>

        <section id="view-admin" class="hide space-y-6">
            <div class="bg-gray-100 p-1.5 rounded-2xl flex gap-2 w-fit mb-6">
                <button onclick="switchAdminSubTab('dash')" id="s-tab-dash" class="px-6 py-2 rounded-xl font-bold admin-tab-active">‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•</button>
                <button onclick="switchAdminSubTab('stock')" id="s-tab-stock" class="px-6 py-2 rounded-xl font-bold text-gray-500">‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
                <button onclick="switchAdminSubTab('users')" id="s-tab-users" class="px-6 py-2 rounded-xl font-bold text-gray-500">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
            </div>

            <div id="admin-dash" class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2 bg-white p-6 rounded-3xl shadow-sm border"><canvas id="salesChart"></canvas></div>
                <div class="space-y-4">
                    <div class="bg-indigo-600 text-white p-6 rounded-3xl">
                        <p class="opacity-80 text-sm">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏ß‡∏°</p>
                        <h3 class="text-3xl font-bold" id="stat-sales">0 ‡∏ø</h3>
                    </div>
                    <div class="bg-white p-6 rounded-3xl border">
                        <p class="text-gray-400 text-sm">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</p>
                        <h3 class="text-3xl font-bold text-indigo-900" id="stat-users">0</h3>
                    </div>
                </div>
            </div>

            <div id="admin-stock" class="hide bg-white p-6 rounded-3xl border space-y-4">
                <form onsubmit="handleAddProduct(event)" class="grid grid-cols-1 md:grid-cols-5 gap-2 bg-gray-50 p-4 rounded-2xl">
                    <input id="p-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" required class="p-2 border rounded-lg">
                    <input id="p-price" type="number" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤" required class="p-2 border rounded-lg">
                    <input id="p-stock" type="number" placeholder="‡∏™‡∏ï‡πá‡∏≠‡∏Å" required class="p-2 border rounded-lg">
                    <input id="p-icon" placeholder="‡∏≠‡∏µ‡πÇ‡∏°‡∏à‡∏¥ (‡πÄ‡∏ä‡πà‡∏ô üçî)" required class="p-2 border rounded-lg">
                    <button class="bg-indigo-600 text-white rounded-lg font-bold">‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                </form>
                <div id="admin-prod-list" class="divide-y overflow-auto max-h-[400px]"></div>
            </div>

            <div id="admin-users" class="hide bg-white p-6 rounded-3xl border">
                </div>
        </section>
      </main>

      <div id="cart-modal" class="hide fixed inset-0 z-50">
        <div class="absolute inset-0 bg-black/50" onclick="toggleCart()"></div>
        <div class="absolute right-0 top-0 h-full w-full max-w-sm bg-white p-6 flex flex-col shadow-2xl">
          <h2 class="text-2xl font-bold mb-6">üõí ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
          <div id="cart-items" class="flex-1 overflow-auto space-y-3"></div>
          <div class="border-t pt-6 mt-4">
            <div class="flex justify-between font-bold text-xl mb-6"><span>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span><span id="cart-total" class="text-indigo-600">0 ‡∏ø</span></div>
            <button onclick="handleCheckout()" id="btn-pay" class="w-full btn-primary text-white py-4 rounded-2xl font-bold shadow-lg">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbymqDsDwWSayPwsGogUwGxxOvobyvCikp_guq6-B2t2oieilor6p3ETeTatOQYk8Psx/exec"; //
    let dbUsers = [], products = [], history = [], currentUser = null, cart = [], salesChart = null;

    // --- Tab Switching Logic ---
    function switchMainTab(tab) {
        ['shop', 'profile', 'admin'].forEach(t => {
            document.getElementById(`view-${t}`).classList.add('hide');
            document.getElementById(`m-tab-${t}`).classList.remove('tab-active');
            document.getElementById(`m-tab-${t}`).classList.add('text-gray-400');
        });
        document.getElementById(`view-${tab}`).classList.remove('hide');
        document.getElementById(`m-tab-${tab}`).classList.add('tab-active');
        document.getElementById(`m-tab-${tab}`).classList.remove('text-gray-400');
        if(tab === 'admin') updateChart();
    }

    function switchAdminSubTab(tab) {
        ['dash', 'stock', 'users'].forEach(t => {
            document.getElementById(`admin-${t}`).classList.add('hide');
            document.getElementById(`s-tab-${t}`).className = "px-6 py-2 rounded-xl font-bold text-gray-500";
        });
        document.getElementById(`admin-${tab}`).classList.remove('hide');
        document.getElementById(`s-tab-${tab}`).className = "px-6 py-2 rounded-xl font-bold admin-tab-active";
    }

    // --- Core Functions ---
    async function fetchData() {
        try {
            const res = await fetch(API_URL);
            const data = await res.json();
            dbUsers = data.users; products = data.products; history = data.history; //
            if(currentUser) refreshUserData();
            renderProducts();
            renderHistory();
            renderAdminData();
        } catch (e) { showToast("‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß", "error"); }
    }

    function checkSession() {
        const saved = localStorage.getItem('sciShopUser');
        if(saved) {
            currentUser = JSON.parse(saved);
            initShop();
            fetchData();
        }
    }

    function initShop() {
        document.getElementById('auth-page').classList.add('hide');
        document.getElementById('shop-page').classList.remove('hide');
        if(currentUser.role === 'admin') document.getElementById('m-tab-admin').classList.remove('hide'); //
        refreshUserData();
    }

    // (‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÄ‡∏ä‡πà‡∏ô handleLogin, handleCheckout, renderProducts ‡∏ô‡∏≥‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤)
    // ... ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö ‡∏ú‡∏°‡∏Ñ‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á Logic ‡∏´‡∏•‡∏±‡∏Å‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏ô‡∏≥‡πÑ‡∏õ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ö
  </script>
</body>
</html>